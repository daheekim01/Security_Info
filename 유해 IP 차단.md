## 유해 IP 차단 🐰

## **1. 유해 도메인 차단?**

* 보안 정책 상, 악성 도메인(예: C2 서버 (Command & Control), 피싱 사이트 등)과 통신하지 못하도록 차단하는 걸 의미합니다.
* 내부 시스템이 감염되거나 해킹되면, 악성코드가 외부 서버(해커의 C2 서버 등)와 연결을 시도하는데
•	공격자가 우리 쪽으로 들어오는 건 아님 (X 인바운드)
•	우리 내부에서 외부로 나가는 연결이 문제 (O 아웃바운드)
➡ 악성 도메인을 차단하려면, "우리 내부 → 외부" 통신을 막아야 한다는 뜻.

| **구분**   | **의미**                        | **예시**                                        |
|------------|--------------------------------|------------------------------------------------|
| **인바운드** | 외부 → 내부로 들어오는 트래픽   | 외부 사용자가 우리 서버에 접속 (예: 웹사이트 방문) |
| **아웃바운드** | 내부 → 외부로 나가는 트래픽    | 우리 서버가 외부 서버로 접속 (예: URL 호출, API 등)  |


### **아웃바운드 차단의 기업 리소스 측면 문제**

* **모든 서버/사용자에 대해 아웃바운드 감시 필요**
o	인터넷 접속 로그 분석
o	DNS 요청 필터링
o	웹 프록시 / 방화벽 정책 정밀 설정 필요

* **많은 트래픽 필터링**
o	기업 환경에서는 수천~수만 개의 도메인 접속이 아웃바운드로 발생
o	유해 도메인 블랙리스트를 실시간 적용하려면 리소스 소비 ↑

* **오탐(정상 도메인 차단) 발생 시 업무 지연**
o	차단된 도메인이 정상 서비스에 사용되면 업무 영향 발생
o	예: CDN, 외부 API, 클라우드 서비스가 포함될 수 있음

* **기술 및 인력 투자 필요**
o	방화벽, DNS 보안, 프록시 시스템 도입/운영 비용 발생
o	위협 인텔리전스 기반 자동화 시스템도 필요

## 📌 즉, 유해 도메인을 차단하려면 인바운드(들어오는 요청)가 아니라 아웃바운드(나가는 요청)를 통제해야 하는데, 이건 기업 내부 전체 인프라에 영향을 주는 복잡하고 리소스 많이 드는 작업이기 때문에 부담이 크다는 의미.

### 대응 전략 (현실적인 방향)

| **전략**             | **설명**                                                      |
|----------------------|---------------------------------------------------------------|
| **DNS 기반 차단**      | DNS 요청 단계에서 유해 도메인 필터링 (ex. Umbrella, Pi-hole)  |
| **프록시 서버 사용**    | 사용자 트래픽을 모두 프록시로 우회시켜 도메인 통제           |
| **EDR/XDR 연동**       | 내부 감염 시스템이 외부로 나가는 행위 감지 후 차단          |
| **서브넷 별 정책 차등화** | 민감 시스템은 인터넷 차단 or 도메인 화이트리스트 방식 사용 |

---

## **2. FQDN (Fully Qualified Domain Name)

* IP 주소가 아닌 도메인 이름 기반으로 통신 대상 서버를 식별하는 방식입니다.
•	IP 기반 차단: 예) 8.8.8.8 같은 특정 IP 주소를 차단하거나 허용하는 것.
•	FQDN : 예) www.google.com

* ✔️ FQDN 기반 차단이 가능한 방화벽이 있고, 불가능한 방화벽도 있음. 도메인 이름(FQDN)을 인식해서 이를 기반으로 접근을 제어할 수 있지만 모든 방화벽이 이 기능을 지원하지는 않는다.
* ✔️ 방화벽 인프라에 FQDN 필터링을 지원하는 제품과 지원하지 않는 제품이 혼재되어 같은 네트워크 상에서 운영되고 있다면, 운영상 혼선을 줄이기 위해 FQDN이 아니라 IP 주소 기반으로 차단 정책을 일괄 적용할 수 있다.
* ✔️ 필요하다면 FQDN 지원되는 방화벽만을 위한 별도 정책을 병행할 수 있겠지만, 운영 복잡도를 높일 수 있어 보통은 피한다.

* 일반적으로 **안티바이러스**와 **서버 백신** 역할을 포함하며, **실시간 보호**와 **정기적인 스캔**을 통해 엔드포인트를 보호합니다.
 * 예시: **SEP (Symantec Endpoint Protection)**: 바이러스와 악성 코드 및 침입 차단, **DLP** 등

### **FQDN 기반 제어가 어려운 이유?**

•	도메인은 시간이 지남에 따라 IP가 바뀔 수 있음
•	DNS를 자주 조회해야 하므로 성능 부담
•	일부 서비스는 CDN이나 로드밸런싱으로 여러 IP를 쓸 수 있음
•	방화벽이 DNS를 직접 해석할 능력이 없으면 구현 불가능


## **3. 차단 모드와 탐지 모드**

### 🐻‍❄️ 보안솔루션을 차단 모드로 돌리는 게 사실상 제일 좋지만 어렵다.

### ✔️**시그니처 기반으로 걸면 제일 좋다. (차단 모드가 아닌 탐지 기반 모드일 때)**

* 시그니처 기반은 특정 문구 등이 걸리면 차단된다. 오탐을 줄이는 방안으로 벤더들이 만들지만 그럼에도 오탐이 있을 수밖에 없다. 이를 통해 트래픽을 차단하는 경우 정상 사용자들도 걸릴 수 있는 문제가 있어 차단 모드를 최대한 안 하려고 한다.

  * 서비스 가용성을 향상하는 측면이 최우선 이므로.

### ✔️**TLS fingerprinter**

* 출발지를 계속 변경해서 보내더라도 특징은 남아있는 TLS fingerprinter를 사용한다.
* 암호화 과정에서 암호화 버전 등을 주고받는 패킷을 열어보면 고유하게 갖는 fingerprinter가 있다. (Attackers had a TLS cipher suite hash corresponding to HTTPS clients running on iOS, which was different from the OS the attackers were using) 
  * 이를 통해 동일한 하나의 fingerprinter로 묶을 수 있으나, fingerprinter는 조합의 결과로 만들어지므로 정상 사용자가 있을 위험이 있다. 

### ✔️**호스트 측에서 유해한 페이로드인지를 분석해서 적용**


